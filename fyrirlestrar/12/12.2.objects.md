---
title: Fyrirlestur 12.2 ‚Äì Hlutir
---

# Fyrirlestur 12.2 ‚Äì Hlutir

## Vefforritun 1 ‚Äî T√ñL107G

### Andri Valur Gu√∞johnsen, [avg4@hi.is](mailto:avg4@hi.is)

---

## Hlutir og hj√∫pun

* Objects & encapsulation
* Ein af a√∞al hugmyndum hlutbundinnar forritunar er a√∞ skipta forritum upp og l√°ta hvern hluta bera √°byrg√∞ √° eigin st√∂√∞u
* Hj√∫pum virkni og fl√¶kjustig, vinnum me√∞ √≠ gegnum _interface_

***

## Methods

* Method er fall √° hlut
* Hva√∞ ef vi√∞ viljum n√°lgast g√∂gn √° hlutnum √∫r falli?
* Notum `this`

***

## `this`

* `this` hagar s√©r √∂√∞ruv√≠si √≠ JavaScript en √≠ √∂√∞rum m√°lum
* Skilgreinist af √æv√≠ hvernig kalla√∞ er √≠ falli√∞
* Utan hluta er `this` global hluturinn, √æ.e. √æar sem allt er geymt (√≠ browser `window`)

***

```javascript
function foo() {
  console.log(this);
}

const bar = {
  foo() {
    console.log(this);
  },
};

console.log(this); // window
foo(); // window
bar.foo(); // {foo: f}
```

***

```javascript
const rabbit = {};
rabbit.speak = (line) => {
  console.log(`The rabbit says '${line}'`);
};

rabbit.speak('I‚Äôm alive.');
// ‚Üí The rabbit says 'I‚Äôm alive.'
```

***

## Apply & call

* Leyfir okkur a√∞ kalla √≠ f√∂ll me√∞ √°kve√∞nu `this`
* `apply` ‚Äì k√∂llum √≠ fall me√∞ gefnu `this` og _fylki_ af arguments
* `call` ‚Äì k√∂llum √≠ fall me√∞ gefnu `this` og _lista_ af arguments

***

<!-- eslint-disable comma-dangle -->

```javascript
function speak(line) {
  console.log(
    `${this.type} rabbit says ${line}`
  );
}
const oldRabbit = { type: 'old', speak };
const hungryRabbit = { type: 'hungry', speak };

oldRabbit.speak('Oh my');
// old rabbit says Oh my
hungryRabbit.speak('I could use a carrot');
// hungry rabbit says I could use a carrot
```

***

<!-- eslint-disable comma-dangle -->

```javascript
function speak(line) {
  console.log(
    `${this.type} rabbit says ${line}`
  );
}
const oldRabbit = { type: 'old' };

speak.apply(oldRabbit, ['Oh my']);
// old rabbit says Oh my
speak.call({ type: 'hungry' }, 'Yum');
// hungry rabbit says Yum
```

***

## Bind

* Leyfir okkur a√∞ festa, _binda_, `this` fyrir f√∂ll
* Kemur okkur ekki √° √≥vart hva√∞ `this` er
* Getum l√≠ka bundi√∞ argument...

***

## Bind ‚Äì d√¶mi

<!-- eslint-disable comma-dangle -->

```javascript
function speak(line) {
  console.log(
    `${this.type} rabbit says ${line}`
  );
}
const blueRabbit = { type: 'blue' };
const bound = speak.bind(blueRabbit);
bound('hi');
// blue rabbit says hi
```

<!-- eslint-disable no-undef -->

```javascript
speak.bind(blueRabbit, 'bye')();
// blue rabbit says bye
```

***

## Arrow f√∂ll

* Arrow f√∂ll eru √∂√∞ruv√≠si‚Äîendurskilgreina ekki `this`
* `this` er skilgreint eins og √æa√∞ var skilgreint √≠ scope kringum fall

***

<!-- eslint-disable comma-dangle -->

```javascript
function normalize() {
  console.log(
    this.coords.map(
      n => n / this.length
    )
  );
}

const o = { coords: [0, 2, 3], length: 5 };

normalize.call(o);
// ‚Üí [0, 0.4, 0.6]
```

***

```javascript
function normalize() {
  function inner(n) {
    return n / this.length;
  }
  console.log(this.coords.map(inner));
}

const o = { coords: [0, 2, 3], length: 5 };

normalize.call(o);
// ‚Üí [NaN, Infinity, Infinity] nema ef window.length innihaldi eitthva√∞ anna√∞ en 0
```

---

## Pr√≥t√≥t√Ωpur

* Flestir hlutir hafa _pr√≥t√≥t√Ωpu_, hlutur sem geymir fleiri properties
* Ef vi√∞ bi√∞jum um property √° hlut sem er ekki skilgreint √° hlut er leita√∞ √° pr√≥t√≥t√Ωpu hans

***

* √ç grunninn h√∂fum vi√∞ `Object`
  - E√∞a n√°nar tilteki√∞ `Object.prototype`
* `Object.getPrototypeOf()` skilar _hva√∞a_ pr√≥t√≥t√Ωpu gildi hefur

***

```javascript
const empty = {};
console.log(empty.toString);
// ‚Üí function toString() { ‚Ä¶ }
console.log(empty.toString());
// ‚Üí [object Object]
```

***

## A√∞rar pr√≥t√≥t√Ωpur

* A√∞rir hlutir hafa a√∞rar pr√≥t√≥t√Ωpur
  - `[]` hefur `Array.prototype`
  - F√∂ll hafa `Function.prototype`
* √ûessar pr√≥t√≥t√Ωpur hafa s√≠nar eigin pr√≥t√≥t√Ωpur!
  - Mynda pr√≥t√≥t√Ωpu ke√∞ju

***

<!-- eslint-disable comma-dangle -->

```javascript
const emptyProto = Object.getPrototypeOf({});
console.log(
  emptyProto === Object.prototype
);
// ‚Üí true
```

<!-- eslint-disable comma-dangle -->

```javascript
console.log(
  Object.getPrototypeOf(Object.prototype)
);
// ‚Üí null
```

***

<!-- eslint-disable comma-dangle -->

```javascript
const funcProto = Object.getPrototypeOf(
  Math.max
);

console.log(
  funcProto === Function.prototype
);
// ‚Üí true
```

<!-- eslint-disable -->

```javascript
console.log(
  Object.getPrototypeOf(funcProto) ===
    Object.prototype
);
// ‚Üí true
```

***

<!-- eslint-disable operator-linebreak, comma-dangle -->

```javascript
const arrayProto = Object.getPrototypeOf([]);

console.log(
  arrayProto === Array.prototype
);
// ‚Üí true
```

***

## Pr√≥t√≥t√Ωpu ke√∞jan

* Hlutir f√° eigindi fr√° pr√≥t√≥t√Ωpunni en eigindi √° hlutnum hafa aldrei √°hrif √° ke√∞juna
  - Getum ekki skrifa√∞ yfir hluti √° pr√≥t√≥t√Ωpu (nema eiga vi√∞ pr√≥t√≥t√Ωpuna sj√°lfa)
* A√∞ setja eigindi √° hlut setur √æa√∞ alltaf √° honum sj√°lfum

***

* Ef vi√∞ bi√∞jum um eigindi √° hlut er reglan:
  - Ef √æa√∞ er √° hlut f√°um vi√∞ √æa√∞
  - Ef ekki f√∂rum vi√∞ upp pr√≥t√≥t√Ωpu ke√∞juna og leitum √æar
  - Ef finnst hvergi er `undefined` skila√∞

***

## Hlutir me√∞ √°kve√∞na pr√≥t√≥t√Ωpu

* `Object.create()` b√Ωr til hlut me√∞ √°kve√∞inni pr√≥t√≥t√Ωpu
* Lei√∞ til a√∞ h√≥pa saman f√∂llum
* Pr√≥t√≥t√Ωpan geymir sameiginlegu f√∂llin

***

<!-- eslint-disable comma-dangle -->

```javascript
const protoRabbit = {
  speak(line) {
    console.log(
      `${this.type} rabbit says '${line}'`
    );
  }
};
const killer = Object.create(protoRabbit);
killer.type = 'killer';
killer.speak('SKREEEE!');
// ‚Üí killer rabbit says 'SKREEEE!'
```

***

## Klasar (classes)

* √ç JavaScript h√∂fum vi√∞ ekki klasa eins og √≠ klass√≠skum hlutbundnum m√°lum
* Notum pr√≥t√≥t√Ωpu til a√∞ erfa fr√° √∂√∞rum hlutum

***

* √ç klass√≠skum erf√∞um
  - Hlutir eru tilvik af kl√∂sum
  - Klasar erfa fr√° √∂√∞rum kl√∂sum
* Me√∞ pr√≥t√≥t√Ωpum
  - Engir klasar
  - Hlutir erfa fr√° √∂√∞rum hlutum

***

## Smi√∞ir og new

* √ç JavaScript eru smi√∞ir f√∂ll, sk√Ωr√∞ me√∞ st√≥rum staf
* √ûegar vi√∞ notum `new` og tilgreinum fall b√∫um vi√∞ til n√Ωjan hlut √æar sem `this` bendir √° hlutinn
* Skilar sj√°lfkrafa `this` sem hlut vegna `new` ef engu er skila√∞
* B√¶tum vi√∞ pr√≥t√≥t√Ωpu til a√∞ b√¶ta vi√∞ sameiginlegum f√∂llum

***

<!-- eslint-disable comma-dangle, func-names -->

```javascript
function Rabbit(type) {
  this.type = type;
}
Rabbit.prototype.speak = function (line) {
  console.log(
    `The ${this.type} rabbit says '${line}'`
  );
};
```

<!-- eslint-disable no-undef -->

```javascript
const weirdRabbit = new Rabbit('weird');
console.log(weirdRabbit);
// Rabbit {type: "weird"}
weirdRabbit.speak('üê∞');
// The weird rabbit says 'üê∞'
```

***

## Yfirskrifu√∞ eigindi

* A√∞ setja eigindi √° hlut setur √æa√∞ alltaf √° honum sj√°lfum
* Getum n√Ωtt til a√∞ yfirskrifa eigindi fr√° pr√≥t√≥t√Ωpu
  - T.d. `toString()` til a√∞ skila s√©rt√¶ku gildi fyrir okkar hlut

***

<!-- eslint-disable no-undef -->

```javascript
Rabbit.prototype.teeth = 'small';
const killerRabbit = new Rabbit('killer');
console.log(killerRabbit.teeth);
// ‚Üí small
```

<!-- eslint-disable no-undef -->

```javascript
killerRabbit.teeth = 'long, sharp, bloody';
console.log(killerRabbit.teeth);
// ‚Üí long, sharp, and bloody
```

***

![Erf√∞ir √° rabbits](img/rabbits.svg "Erf√∞ir √° rabbits")

***

<!-- eslint-disable func-names -->

```javascript
function Rabbit(type) {
  this.type = type;
}

const fooRabbit = new Rabbit('foo');
console.log(fooRabbit.toString());
// "[object Object]"

Rabbit.prototype.toString = function () {
  return `Rabbit of type ${this.type}`;
};

console.log(fooRabbit.toString());
// "Rabbit of type foo"
```

---

## Classes

* √ç ECMAScript 6 er `class` skilgreint
* _Syntactic sugar_ til a√∞ herma eftir klass√≠skum OO hlutum me√∞ pr√≥t√≥t√Ωpum
* `extends`, `constructor`, `super`, `static` og getters og setters

***

<!-- eslint-disable no-unused-vars, lines-between-class-members, comma-dangle -->

```javascript
class Rabbit {
  constructor(type) {
    this.type = type;
  }
  speak(line) {
    console.log(
      `${this.type} rabbit says '${line}'`
    );
  }
  toString() {
    return `Rabbit of type ${this.type}`;
  }
}

const killerRabbit = new Rabbit('killer');
```

***

<!-- eslint-disable -->

```javascript
class Foo {
  constructor(name) {
    this._name = name;
  }

  hi() { return 'hi!'; }

  static bar() { return 1; }

  get name() { return this._name; }

  set name(value) { this._name = value; }
}
```

***

<!-- eslint-disable no-undef, no-unused-expressions-->

```javascript
const foo = new Foo('Asdf');
foo.hi(); // "hi!"
foo.name = 'bar';
foo.name; // "bar"

Foo.bar(); // 1
```
